# Roadmap: Арбитражный бот для Solana

## Цель проекта
Создание надежного арбитражного бота на Rust с веб-интерфейсом для поиска и исполнения прибыльных сделок между различными DEX на блокчейне Solana. Проект развивается поэтапно с фокусом на безопасности, стабильности и масштабируемости.

---

## Этап 1: Базовая инфраструктура

### Статус: ✅ Завершено
- [x] Структура проекта Rust
- [x] Система конфигурации (config.toml, .env)
- [x] Модуль управления кошельком (wallet.rs)
- [x] Базовый интерфейс DEX (dex.rs с заглушками)
- [x] Движок арбитража (arbitrage.rs)
- [x] Система мониторинга (monitor.rs)
- [x] Скрипты установки и управления (install.sh, start.sh, stop.sh, update.sh)
- [x] Systemd unit для продакшн-запуска
- [x] Ротация логов (logrotate)
- [x] Резервное копирование ключей (backup_keys.sh)
- [x] Базовые интеграционные тесты

### Результат

Работающий каркас бота с режимом симуляции, готовый к расширению реальной логикой.

---

## Этап 2: Реализация интеграций с DEX

### Цель: Замена заглушек на реальные интеграции

#### 2.1 Интеграция с Raydium

- [x] Изучение Raydium AMM протокола
- [x] Получение адресов пулов для торговых пар
- [x] Реализация чтения резервов из аккаунтов пулов
- [x] Расчёт цены по формуле x*y=k
- [x] Построение инструкций swap
- [x] Подписание и отправка транзакций
- [x] Обработка ошибок и retry-логика
- [x] Тестирование на devnet (созданы тесты в `tests/devnet_test.rs`, см. `tests/README_DEVNET.md`)

#### 2.2 Интеграция с Orca

- [x] Изучение Orca протокола
- [x] Реализация получения цен
- [x] Реализация выполнения свопов
- [x] Тестирование на devnet (созданы тесты в `tests/devnet_test.rs`)

#### 2.3 Интеграция с Serum (опционально)

- [x] Изучение Serum DEX протокола
- [x] Реализация интеграции
- [x] Тестирование на devnet (созданы тесты в `tests/devnet_test.rs`)

#### 2.4 Улучшение движка арбитража

- [x] Исправление мутабельности consecutive_failures
- [x] Реализация атомарных транзакций (если возможно) - базовая структура готова, требуется доработка для реального объединения инструкций
- [x] Улучшение расчёта оптимального объёма сделки
- [x] Учёт комиссий DEX при расчёте прибыли
- [x] Обработка slippage в реальном времени - базовая структура готова, требуется доработка для получения реального slippage из симуляций
- [x] Таймауты и retry для транзакций

#### 2.5 Тестирование и валидация

- [x] Расширение интеграционных тестов
- [x] Моки для RPC и DEX API
- [x] Тесты на devnet с реальными транзакциями
- [x] Стресс-тесты производительности
- [x] Проверка безопасности

### Критерии готовности

- Все DEX возвращают реальные цены
- Свопы выполняются на devnet
- Обработка ошибок покрывает основные сценарии
- Тесты проходят успешно

---

## Этап 3: Веб-интерфейс

### Цель: Создание веб-интерфейса для мониторинга и управления

#### 3.1 Выбор стека веб-интерфейса

- [x] Выбор фреймворка (акслер, yew, или отдельный сервер на actix-web/axum) — **Выбрано: axum**
- [x] Архитектура: встроенный сервер или отдельный сервис — **Выбрано: встроенный сервер в модуле `src/web/`**
- [x] Проектирование API endpoints — **См. `docs/WEB_STACK_DECISION.md`**

#### 3.2 Backend API (Rust) — ✅ Завершено

- [x] HTTP сервер (actix-web или axum) — **Реализовано на axum**
- [x] REST API endpoints:
  - [x] GET /api/status — статус бота
  - [x] GET /api/balance — баланс кошелька
  - [x] GET /api/opportunities — текущие арбитражные возможности
  - [x] GET /api/history — история сделок
  - [x] GET /api/metrics — метрики производительности
  - [x] GET /api/config — read-only просмотр конфигурации
  - [x] POST /api/config/reload — перезагрузка конфигурации (заглушка)
  - [x] POST /api/control/start — запуск бота
  - [x] POST /api/control/stop — остановка бота
  - [x] GET /health — health check endpoint
- [x] WebSocket для real-time обновлений (/ws/updates, /ws/logs)
- [x] Аутентификация и авторизация (Basic Auth)
- [x] CORS настройки

#### 3.3 Frontend — ✅ Завершено

- [x] Dashboard с основными метриками:
  - [x] Статус бота (активен/остановлен)
  - [x] Баланс кошелька
  - [x] Количество успешных/неудачных сделок
  - [x] Текущая прибыль
  - [x] График прибыли по времени (Chart.js)
- [x] Таблица арбитражных возможностей в реальном времени
- [x] История сделок с фильтрацией
- [x] Настройки (read-only просмотр config.toml)
- [x] Логи в реальном времени (WebSocket stream)
- [x] Интерфейс в стиле Fortnite (яркие цвета, градиенты, анимации)
- [ ] Алерты и уведомления (базовая структура готова)

#### 3.4 Безопасность веб-интерфейса

- [ ] HTTPS (TLS)
- [ ] Защита от CSRF
- [ ] Rate limiting
- [ ] Валидация входных данных
- [ ] Логирование доступа

### Критерии готовности

- Веб-интерфейс доступен и отображает актуальные данные
- Real-time обновления работают через WebSocket
- Аутентификация защищает доступ
- Интерфейс работает на мобильных устройствах (responsive)

---

## Этап 4: Оптимизация и масштабирование

### Цель: Улучшение производительности и надёжности

#### 4.1 Оптимизация производительности

- [ ] Параллельное получение цен с DEX
- [ ] Кэширование цен и пулов
- [ ] Оптимизация RPC запросов (batch requests)
- [ ] Использование WebSocket для подписки на обновления цен
- [ ] Профилирование и оптимизация hot paths
- [ ] Минимизация задержек транзакций

#### 4.2 Улучшение мониторинга

- [ ] Интеграция с Prometheus
- [ ] Метрики: количество сделок, прибыль, задержки, ошибки
- [ ] Grafana дашборды
- [ ] Telegram уведомления (уже заложено в .env)
- [ ] Webhook интеграции
- [ ] Health checks endpoint

#### 4.3 Улучшение обработки ошибок

- [ ] Централизованная система ошибок (Sentry или аналог)
- [ ] Детальное логирование с контекстом
- [ ] Автоматическое восстановление после сбоев
- [ ] Circuit breaker для RPC endpoints

#### 4.4 База данных для истории

- [ ] Выбор БД (SQLite для простоты или PostgreSQL для масштаба)
- [ ] Схема для хранения сделок, метрик, логов
- [ ] Миграции БД
- [ ] Интеграция с движком арбитража

#### 4.5 Масштабирование

- [ ] Поддержка множественных кошельков
- [ ] Распределённая архитектура (опционально)
- [ ] Load balancing для RPC запросов
- [ ] Горизонтальное масштабирование (если необходимо)

### Критерии готовности

- Время реакции на арбитражные возможности < 100ms
- 99.9% uptime
- Полная история сделок в БД
- Метрики доступны в Grafana

---

## Этап 5: Продвинутые функции

### Цель: Расширение функциональности

#### 5.1 Продвинутые стратегии арбитража
- [ ] Треугольный арбитраж (A->B->C->A)
- [ ] Учёт MEV и фронт-раннинга
- [ ] Динамическая корректировка параметров (min_profit, slippage)
- [ ] Машинное обучение для предсказания прибыльности

#### 5.2 Дополнительные DEX
- [ ] Jupiter (агрегатор)
- [ ] Lifinity
- [ ] Meteora
- [ ] Другие популярные DEX

#### 5.3 Улучшение веб-интерфейса
- [ ] Расширенная аналитика
- [ ] Backtesting исторических данных
- [ ] Стратегия builder (визуальное создание правил)
- [ ] Экспорт данных (CSV, JSON)

#### 5.4 Безопасность и аудит
- [ ] Security audit кода
- [ ] Penetration testing веб-интерфейса
- [ ] Регулярные обновления зависимостей
- [ ] Документация по безопасности

#### 5.5 Документация
- [ ] API документация (OpenAPI/Swagger)
- [ ] Руководство пользователя
- [ ] Руководство разработчика
- [ ] Архитектурная документация

### Критерии готовности
- Все продвинутые функции протестированы
- Документация полная и актуальная
- Security audit пройден

---

## Приоритеты и временные рамки

### Краткосрочные (1-2 месяца)
- Этап 1: Базовая инфраструктура
- Этап 2: Реализация интеграций с DEX
- Базовое тестирование на devnet

### Среднесрочные (3-4 месяца)
- Этап 3: Веб-интерфейс
- Этап 4.1-4.3: Оптимизация и мониторинг

### Долгосрочные (6+ месяцев)
- Этап 4.4-4.5: База данных и масштабирование
- Этап 5: Продвинутые функции

---

## Принципы разработки

1. **Безопасность прежде всего**
   - Всегда тестировать в simulation_mode на devnet
   - Никогда не коммитить секреты
   - Регулярные бэкапы ключей

2. **Стабильность**
   - Comprehensive тестирование перед каждым релизом
   - Постепенный rollout изменений
   - Мониторинг в продакшене

3. **Масштабируемость**
   - Модульная архитектура
   - Легко добавлять новые DEX
   - Оптимизация производительности

4. **Документация**
   - Код должен быть самодокументируемым
   - Важные решения документируются
   - Обновление roadmap при изменениях
